<!DOCTYPE html>
<html>
<head>
    <title>Recent Blog Posts | TomMustBe12 Blog</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
</head>
<body>
<nav>
    <h3>TomMustBe12 Blog</h3>
    <a href="https://tommustbe12.com">Homepage</a>
</nav>

<div class="largeContainer">
    <div class="stickyInfo">
        <h4>Recent Blog Posts</h4>
        <h4>A place where I can post what I think is interesting.</h4>
    </div>

    <div class="content">
        <div class="title">
            <h1>Recent Blog Posts</h1>
            <sub>These are my latest blog posts.</sub>
        </div>

        <main id="posts"></main>
    </div>
</div>

<script>
function stripHtml(html) {
    const tmp = document.createElement("div");
    tmp.innerHTML = html;
    return tmp.textContent || tmp.innerText || "";
}

async function loadPosts() {
    try {
        const response = await fetch('https://corsproxy.io/?https://tmb12.link/blogs/previews');
        if (!response.ok) throw new Error(`Network response was not ok (${response.status})`);
        const posts = await response.json();

        // Sort posts by date, newest first
        posts.sort((a, b) => new Date(b.dateTime) - new Date(a.dateTime));

        const container = document.getElementById("posts");
        container.innerHTML = "";

        posts.forEach(post => {
            const postEl = document.createElement("div");
            postEl.className = "blog-post";

            const h2 = document.createElement("h2");
            const a = document.createElement("a");
            a.href = `post.html?id=${post.id}`;
            a.textContent = post.title;
            h2.appendChild(a);
            postEl.appendChild(h2);

            const pMeta = document.createElement("p");
            pMeta.className = "date";
            pMeta.textContent = `${post.dateTime} | Views: ${post.views}`;
            postEl.appendChild(pMeta);
            
            const previewText = stripHtml(post.preview);
            const words = previewText.split(/\s+/).slice(0, 20).join(" ");
            const pPreview = document.createElement("p");
            pPreview.textContent = words;
            postEl.appendChild(pPreview);

            container.appendChild(postEl);
        });

    } catch (err) {
        console.error("Error loading posts:", err);
        document.getElementById("posts").textContent = "Failed to load posts.";
    }
}



window.addEventListener("DOMContentLoaded", loadPosts);
</script>
</body>
</html>
